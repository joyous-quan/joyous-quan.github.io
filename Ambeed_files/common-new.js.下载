document.write("<script language='javascript' src='/static/js/jquery.min.js'></script>");
document.write("<script language='javascript' src='/static/js/DoAjax.js'></script>");
document.write("<script language='javascript' src='/static/layer/layer.js'></script>");
document.write('<script type="text/javascript" src="/static/js/tool/js.js?v=1"></script>');
document.write('<script type="text/javascript" src="/static/js/tool/hex.js"></script>');
var Apharm={};
var cartCookie='';
var Country="United States|USD";
var filedomain="https://file.ambeed.com";
var memInfoParams={};//会员信息请求参数，加入selInfo：true查询组织机构，国家信息
var search_history=[];//搜索历史
var StockIsLoading=false;//库存是否正在加载
window.onload=function(){
    //DOM文档加载完成判断是否为IE，为IE，并且大于IE8，引用IE兼容CSS
    var Sys = {};
    var ua = navigator.userAgent.toLowerCase();
    var s;
    (s = ua.match(/rv:([\d.]+)\) like gecko/)) ? Sys.ie = s[1] :
    (s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1] : 0;
    if (Sys.ie>8){
        $($('head')[0]).append($('<link href="/static/css/common_ie.css" rel="stylesheet" type="text/css"/>'));
    }
    if($("body").height()<900){
        $(".dv_logistics").css({"margin-top":"300px"});
    }
    if(!isempty(getCookie("access_token"))){
        _DoAjaxAsyncTrue("GET",memInfoParams, "/webapi/v1/getmemberinfo",function(res){
            if(!isempty(res)){
                Apharm=res;
                $(".a_my_cart").attr("href","/mem/my-cart.html");
                if($(".head_login").length>0){
                    $(".head_login").css("visibility","visible").html('<a href="/mem/personal-information.html">'+Apharm.hid_name+"</a><a  href='/mem/logout'>, Sign Out</a>");
                }
                if(Apharm.cart_count>0&&$(".cart-count").length>0){ //公共购物车数量
                    $(".cart-count").css("visibility","visible").html(Apharm.cart_count).parent().attr("href","/mem/my-cart.html");
                }
                if($(".header_cart").length>0){
                    $(".header_cart").css("visibility","visible").html(Apharm.cart_count);
                }
                if($(".sp_mem_name").length>0){$(".sp_mem_name").html(Apharm.mem_name);}
                try{_loadMemberInfo();}catch (e){}//其他页面需要读取会员信息方法
            }
        });
    }else{
        try{_comNoLogin();}catch (e){}//其他页面需要执行未登录方法
        _uptCartInfo();//购物车信
    }
    //----------------
    //分类提示框
    $(".tips-kuang").hover(function(){
        $(this).find(".tips-content").show();
    },function(){
        $(this).find(".tips-content").hide();
    });

    $(".tips-content li").each(function(i,v){
        $(".tips-content li").click(function(event){
            var e=arguments.callee.caller.arguments[0]||event;
            if (e && e.stopPropagation) {
                e.stopPropagation();
            } else if (window.event) {
                window.event.cancelBubble = true;
            }
            $(this).parent().siblings(".tips-txt").html($(this).find("span").html());
            $(".tips-content").hide();
        });
    });
    $(".tips-content li").hover(function(){
        $(this).addClass("tips-active").siblings().removeClass('tips-active')
    });
    //----------------
    if(isempty(getCookie("amb_cart_key"))){
        var getcookie=_getCartCookie();
        if(isempty(getcookie)){
            var newcartcookie=_getNonDuplicate();
            _setCartCookie(newcartcookie);
            cartCookie=newcartcookie;
        }else{
            cartCookie=getcookie;
        }
    }
    //-----------------------------------------
    //搜索框获取焦点时
    $(".head-search #pro_keyword").focus(function(){
        if(search_history.length==0){
            _DoAjaxAsyncTrue("GET",{},"/webapi/v1/searchhistory",function(res){
                if(res.search_history.length>0){
                    _loadSearchHistory(res.search_history);//加载搜索历史
                    search_history=res.search_history;
                }
            });
        }else{
            _loadSearchHistory(search_history);//加载搜索历史
        }
    });
    $(".head_login").css("visibility","visible");//显示登录链接
    _uptFavorites();//更新产品列表收藏状态
    if($("head link[type='image/x-icon']").length==0){
        $("<link>").attr({ rel: "shortcut icon",type: "image/x-icon",href: "/static/img/ambeed.ico"}).appendTo("head");
    }

    ////修改产品列表中的Add to Cart,变为查看详情
    //if($(".sales-dl").length>0){
    //    $(".sales-dl").each(function(idx,item){
    //        $(this).find('dd .red-btn').html('Detail').addClass("show").attr("href",$(this).find("dt .a_img_box").attr("href")).attr("target","_blank");
    //    });
    //}
    if($(".fixed-txt:contains('21-61629020')").length>0){
        $(".fixed-txt:contains('21-61629020')").text('630-580-1088');
    }
    if($(".fixed-txt:contains('sales@Apharmatech.com')").length>0){
        $(".fixed-txt:contains('sales@Apharmatech.com')").text('sales@ambeed.com').parent().attr("href","mailto:sales@ambeed.com");
    }
    //谷歌统计
    _loadScript('https://www.googletagmanager.com/gtag/js?id=UA-133590782-1',function(){
        gtag('js', new Date());
        gtag('config', 'UA-133590782-1');
    });
    //谷歌统计
    _loadGoogle(window,document,'script','dataLayer','GTM-KCPSBWP');

    //谷歌统计
    $("body").prepend('<noscript></noscript>');
    $("noscript").append('<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KCPSBWP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>');

    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
};
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-133590782-1']);
_gaq.push(['_setDomainName', 'ambeed.com']);
_gaq.push(['_trackPageview']);
_udn = "ambeed.com";
//谷歌统计
function _loadGoogle(w,d,s,l,i){
    w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
}
//谷歌统计方法
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

//加载搜索历史HTML
function _loadSearchHistory(sh){
    if(sh.length>0){
        var search_html='';
        $.each(sh,function(idx,item){
            search_html+='<dd class="overflowHidder dd_search_history"><a href="/search/Search.html?keyword='+encodeURI($.trim(item))+'">'+item+'</a><label><span class="sp_nav_record">Search Record</span><span class="sp_nav_delete">Delete</span></label></dd>';
        });
        $("#searchResult_List").html(search_html);
        $("#searchResult_List .dd_search_history .sp_nav_delete").unbind().click(function(){
            var keyword=$.trim($(this).parent().parent().find('a').text());
            $(this).parent().parent().remove();
            _DoAjaxAsyncTrue("DELETE",{"keyword":keyword},"/webapi/v1/searchhistory",function(res){
                search_history=res.search_history
            })
        });
    }
}

//更新产品列表收藏状态
function _uptFavorites(){
    //添加收藏按钮个数大于0
    if($(".xin-add").length>0){
        if(!isempty(getCookie("access_token"))){//判断产品列表用户是否已经收藏
            _DoAjaxAsyncTrue("GET", {}, "/webapi/v1/mem/memFavoritesProids",function(res){
                if(res.length>0){
                    $(".xin-add").each(function(){
                        var proid=$(this).attr("proid");
                        if (!isempty(proid)&&$.inArray(proid,res)>-1){
                            $(this).attr("src","/static/img/xin-red.png").attr("proid",proid).attr("onclick","_delFavorites(this)");
                            $(this).parent().addClass("isFavorites");
                        }
                    })
                }
            });
        }
    }
}
//加载整页价格信息,绑定查询库存方法
function _loadAllPoriceByBDs(){
    /*
    var proids=[];
    var bds=[];
    $(".sales-hover-list").each(function(){
        var proid=$(this).attr("proid");
        if(!isempty(proid)){proids.push(proid);}
        var bd=$(this).attr("bd");
        if(!isempty(bd)){bds.push(bd);}
    });
    if(proids.length>0){
        _DoAjaxAsyncTrue("GET",{proids:proids},"/webapi/v1/productPriceByProids",function(res){
            if(!isempty(res)){
                $(".sales-hover-list img").parent().remove();//删除loading图片
                $(".sales-hover-list").each(function(idx,item){
                    var ulobj=$(this);
                    var proid=ulobj.attr("proid");
                    if(!isempty(proid)){
                        var ollist=res[proid];
                        if(!isempty(ollist)){
                            $.each(ollist,function(idx,item){
                                ulobj.append('<ol prid="'+item.pr_id+'" newprice="'+item.unit_code+' '+item.salesPrice.toFixed(2)+'" oldprice="'+item.unit_code+' '+item.newPrice.toFixed(2)+'"><li>'+item.pr_size+'</li><li>'+item.unit_code+' '+item.newPrice.toFixed(2)+'</li><li class="sale-price"></li><li><select><option>0</option></select></li></ol>');
                            });
                        }
                    }
                });
            }
        });
    }
    //绑定加载库存方法
    if(bds.length>0){
        var aAddCart=$(".sales-dl a:contains('Add to Cart'):not('.green-btn')");
        if(aAddCart.length>0){
            aAddCart.hover(function(){
                var ul=$(this).parent().find(".sales-hover-list");
                var ol_length=ul.find("ol").length;
                if(ol_length>1){
                    var bd=ul.attr("bd");
                    var isOkCls=ul.hasClass("stockLoadOk");
                    if(!StockIsLoading&&!isempty(bd)&&!isOkCls){
                        StockIsLoading=true;//更改正在查询库存，防止重复加载
                        var addCartBtn=$(this).parent().find(".green-btn");
                        addCartBtn.text("Loading...");
                        //存储库存信息
                        var post_obj = {
                            "timestamp": new Date().getTime(),
                            "bd": bd
                        };
                        post_obj['_'] = getSign(post_obj, 1);
                        post_obj['__'] = ['timestamp','bd'];  // 按照对象顺序，不可更换
                        var encoded = base64encode(JSON.stringify(post_obj));
                        post_obj = {
                            _xsrf: getCookie("_xsrf"),
                            params: encoded
                        };
                        var ajaxTimeoutTest =$.ajax({
                            type: "POST",
                            timeout: 20000, //超时时间设置，单位毫秒
                            url: "/webapi/v1/getproductstock",
                            //url: "/webapi/v1/getproductstock",
                            async: true,
                            data: post_obj,
                            success: function (response) {
                                if (response.code == 200) {
                                    if(response.value.length>0){
                                        var noFZUSASize=0;//未封装美国库存量
                                        var hasFZNumber={};//已封装规格瓶数
                                        var sumCount=0;//总下拉列表可选数量
                                        $.each(response.value,function(idx,item){
                                            if(item.size=="unwrapped"){
                                                noFZUSASize=item.quantityusa;
                                            }else{
                                                hasFZNumber[item.size]=item.quantityusa;
                                            }
                                        });
                                        $.each(ul.find("ol"),function(idx,item){
                                            if(idx>0){//过滤表头
                                                var tsSize=$(this).find("li:eq(0)").text();
                                                var liSize=ul.find("li:contains('"+tsSize+"')");
                                                var noFZ= Math.floor(Number(noFZUSASize * 1000) / _getSizeByMg(tsSize));//未封装改规格瓶数
                                                var hasFZ=isempty(hasFZNumber[tsSize])?0:hasFZNumber[tsSize];//该规格已封装瓶数
                                                var count=noFZ;//未封装+已封装总瓶数，默认值未封装瓶数
                                                if(liSize.length>0){
                                                    count += hasFZ;//改规格未封装+已封装
                                                }
                                                sumCount+=count;
                                                $(this).find("select").html(_getSelect(count));//加载select
                                                if(count>0){
                                                    $(this).find(".sale-price").html($(this).attr("newprice"));
                                                }else{
                                                    $(this).find(".sale-price").html($(this).attr("oldprice"));
                                                }
                                            }
                                        });
                                        StockIsLoading=false;
                                        ul.addClass("stockLoadOk");//添加加载成功样式，下次不加载
                                        if(sumCount>0){
                                            addCartBtn.text("Add to Cart").attr("onclick","_addCart(this)");
                                        }else{
                                            addCartBtn.hide();//库存价格为空隐藏添加购物车按钮
                                        }
                                    }else{
                                        StockIsLoading=false;
                                        addCartBtn.hide();//库存价格为空隐藏添加购物车按钮
                                    }
                                }
                            },complete : function(XMLHttpRequest,status){ //请求完成后最终执行参数
                                StockIsLoading=false;
                                if(status=='timeout'){//超时,status还有success,error等值的情况
                                    ajaxTimeoutTest.abort();//终止ajax请求
                                }
                            }
                        });
                    }
                }
            });
        }
    }*/
}
//公共产品列表添加购物车
function _addCart(obj){
    var ul=$(obj).parent().find(".sales-hover-list");
    var bdNo=ul.attr("bd");
    var proid=ul.attr("proid");
    var prices=[];//选择的价格信息
    $.each(ul.find("ol"),function(idx,item){
        if(idx>0){//排除表头
            var sel=$(this).find("select");
            var prId=sel.parent().parent().attr("prid");
            var selVal=parseInt($(this).find("select").val());
            if(selVal>0&&!isempty(prId)){
                prices.push({id:prId,quantity:selVal});
            }
        }
    });
    if(prices.length==0){
        $(obj).parent().find(".prlist_error").html('Please select the quantity.');
        return false;
    }
    if(isempty(bdNo)||isempty(proid)){
        $(obj).parent().find(".prlist_error").html('Please select the quantity.');
        return false;
    }
    var loadidx=layer.load(2);
    _DoAjaxAsyncTrue("POST",{"proid":proid,"price":prices,"bd":bdNo},"/webapi/v1/user/cart",function(){
        layer.close(loadidx);
        aBox._warntip("Added Cart Success!");
        _uptCartInfo();//更新购物车数量
    });
}
//根据item。size获取计算数量,type=='size':g*1000转换成 mg ，作计算。tyoe="str"：1g取1,作展示
function _getSizeByMg(size,type){
    type=isempty(type)?'size':type;
    var res=0;
    try{
        size=size.toLowerCase();//转小写
        if(size.indexOf("mg")>-1) {
            res = parseInt(size.split("mg")[0]);
        }else if(size.indexOf("kg")>-1){
            res = parseInt(size.split("kg")[0])*1000000;
        }else if(size.indexOf("g")>-1){
            if(type=='size'){
                res=parseInt(size.split("g")[0])*1000;
            }else{
                res=parseInt(size.split("g")[0])
            }
        }
    }catch (e){}
    return res;
}

//根据可买份数加载select
    function _getSelect(len){
        len=len>10?10:len;
        var sel='<select  class="dv_select">';
        for(var i=0;i<=len;i++){
            sel+='<option>'+i+'</option>';
        }
        return sel+'</select>';
    }
//生成一个用不重复的ID
function _getNonDuplicate(){
  var  idStr = Date.now().toString(36);
  idStr += Math.random().toString(36).substr(3);
  return idStr;
}

//获取购物车Cookie
function _getCartCookie(){
    return _DoAjax("GET",{},"/webapi/v1/user/cartcookie");
}
function _setCartCookie(cartkey){
    _DoAjaxAsyncTrue("POST",{"amb_cart_key":cartkey},"/webapi/v1/user/cartcookie");
}

/*弹窗*/
var aBox={
    _warn:function(msg){//提示，手动关闭
        if($(".dv_load_gif").length>0){$(".dv_load_gif").hide();}
        layer.open({
            area: ['350px','200px'],
            fix: false, //不固定
            shadeClose: true,
            title: "Prompt Information",
            btn: ['confirm'],
            btnAlign: 'c',
            yes: function(index, layero){
                layer.closeAll();
            },
            content: msg,
            resize:false
        });
    },
    _conf:function(msg,funcName){//确认
        layer.open({
            area: ['350px','200px'],
            fix: false, //不固定
            shadeClose: true,
            title: "Prompt Information",
            btn: ['confirm','cancel'],
            btnAlign: 'c',
            yes: function(index, layero){
                funcName();
            },
            btn2: function(index, layero){
                layer.closeAll();
            },
            content: msg,
            resize:false
        });
    },
    _warntip:function(msg){//提示信息 自动关闭 3秒后关闭
        var tipHtml='<div style="width: 100%;height: 100%;display:table;">'+
            '<label style="padding:20px;display: table-cell;text-align: center;vertical-align: middle;word-break:break-all;">'+msg+'</label></div>';
        _boxShow('html',350,200,"Prompt Information",tipHtml,3000);
    },
    _cntbox:function(html,title,w,h){//纯内容窗口，只有×关闭
        isempty(w)?w=800:w;
        isempty(h)?h=560:h;
        _boxShow("html",w,h,title,html);
    },
    _urlbox:function(url,title,w,h){//iframe窗口，只有×关闭,cat:html/url
        w=isempty(w)?800:w;
        h=isempty(h)?560:h;
        _boxShow("url",w,h,title,url);
    }
};

    //弹出层
    function _boxShow(cat,w,h,title,url,time) {
        if (title == null || title == '') {
            title = false;
        }
        if (time == null || time == '') {
            time = 0;
        }
        if (url == null || url == '') {
            url = "error.html";
        }
        if (w == null || w == '') {
            w = ($(window).width());
        }
        if (h == null || h == '') {
            h = ($(window).height());
        }
        var type = (cat == "url") ? 2 : 1;
        layer.open({
            type: type,
            area: [w + 'px', h + 'px'],
            fix: false, //不固定
            //maxmin: true,
            time:time,
            btnAlign: 'c',
            title: title,
            content: url,
            resize:false
        });
    }

/*绑定确定键执行的方法*/
function _domKey13(funcname){
    $(document).keypress(function(e) {
        if(e.which == 13) {
            funcname();
        }
    })
}
function _closeAndReload(){//关闭弹窗并刷新父页面
    window.parent.location.reload();
    setTimeout(function(){layer.close();},2000);
}
function _imgyzm(obj){
    $(".img_yzm").attr("src",("/yzm?"+Math.random().toFixed(2)));
}
function _chkEmail(val){
    return /^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/.test(val)?true:false;
}
function _chkPassword(val){
    return /^(?!\d+$)(?![a-zA-Z]+$)[\dA-Za-z]{6,18}$/.test(val)?true:false;
}
function _chkPhone(val){
    return val!=''?true:false;
    //return /^1\d{10,15}$/.test(val)?true:false;
}
function _chkZipCode(val){
    return val!=''?true:false;
}

function _getNullObject(obj){
    for (var Key in obj) {
        if(isempty(obj[Key])||obj[Key]==undefined){
            obj[Key]=""
        }
    }
    return obj;
}
//搜索提示列表点击时
function _aSearchClick(href,en_name){
    _DoAjaxAsyncTrue("POST",{"keyword":en_name,"addSearchLog":true,"search_keyword":$("#pro_keyword").val()},"/webapi/v1/searchhistory",function(res){//添加搜索历史记录
        if(res.search_history.length>0){search_history=res.search_history;}
        _aClickOpenWindow(href,'_self');
    });
}

//DOM添加A标签。打开新链接,cat=默认打开新窗口，cat=_self,本窗口加载。
function _aClickOpenWindow(href,cat){
    cat=isempty(cat)?"_blank":cat;
	var aobj = document.createElement("a");
	aobj.setAttribute("target", cat);
	aobj.setAttribute("href", href);
	aobj.setAttribute("type", "hidden");
	document.body.appendChild(aobj);
	aobj.click();
}

var timeoutId;
function searchPro(keyword){
    if(keyword.length>2){
        //对上次未完成的延迟操作进行取消
        clearTimeout(timeoutId);
        //对于服务器端进行交互延迟500ms,避免快速打字造成的频繁交互
        timeoutId = setTimeout(function () {
            _loadkeywordlist(keyword);
        },200);
    }else{
       $("#searchResult_List dd").remove();
    }
    if(isempty(keyword)){
        _loadSearchHistory(search_history);//加载搜索历史
    }
 }
//异步请求-关键字改变时
function _loadkeywordlist(keyword){
	var encoded = base64encode(JSON.stringify({keyword:keyword}));
	$.ajax({
        type: "GET",
        url: "/webapi/v1/searchquery",
        async: true,
        data: {params: encoded, _xsrf: getCookie("_xsrf")},
        beforeSend: function (XMLHttpRequest) {
        },
        success: function (response) {
            if (!isempty(response)) {
                if (response.code == 200) {
                    var reslist = response.value;
                    if (reslist.length > 0) {
                        $("#searchResult_List dd").remove();
                        var ulHtml = '';
                        for (var i = 0; i < reslist.length; i++) {
							if( reslist[i].s_menucat==0){
                                var mdl_html='',mdl_class='';
                                if(!isempty(reslist[i].mdl)){
                                    mdl_html='<i>'+reslist[i].mdl+'</i>';
                                    mdl_class='dd_mdl';
                                }
                                ulHtml += '<dd class="overflowHidder '+mdl_class+'"><a  title="'+reslist[i].nameEn+'" onclick="_aSearchClick(\'/products/' + reslist[i].url + '\',\''+reslist[i].nameEn+'\')" href="javascript:;">'+mdl_html+ reslist[i].show_name + '</a></dd>';
							}else {
								ulHtml += '<dd class="overflowHidder"><a title="'+reslist[i].name+'"  href="/' + reslist[i].url + '">' + reslist[i].name + '</a></dd>';
							}
                        }
                        $("#searchResult_List").prepend(ulHtml);
                    }else{
                        $("#searchResult_List").html('');
                    }
                }
            }
        }
    });
}

//取2位小数，直接舍去
function _toDecimal(val){
    var f = parseFloat(val);
	if (isNaN(f)) {
		return '';
	}
	var nowval=val.toString().replace(/(^\s*)|(\s*$)/g, "");
	var result=Math.floor(parseFloat(nowval)*100)/100;
	if(isNaN(result)){
		return '';
	}else{
		return parseFloat(result).toFixed(2);
	}
}
//更新购物车信息
function _uptCartInfo(){
    _DoAjaxAsyncTrue("GET",{},"/webapi/v1/user/shopcart",function(res){
        $(".header_cart,.head-cart .cart-count").css("visibility","visible").html(res.length);
        if(res.length==0){
            $(".header_cart,.head-cart .cart-count").css("visibility","hidden").html(0);
        }
    });
}

//获取国家
function _getCountry(){
    $("#lab_Language img").attr("src","http://www.ambeed.com/static/img/language/United%20States.png");
    _DoAjaxAsyncTrue("GET",{},"/webapi/v1/countrycookie",function(res){
        try {
            if(!isempty(res)) {
                Country = res;
                $("#lab_Language").html('<img src="http://www.ambeed.com/static/img/language/' + res.split('|')[0].replace(' ', "%20")+'.png">'+res.split('|')[0]);
            }
        } catch (e) {}
        $("#lab_Language").css({"display":"inline-block"});
    });
}

function _openSearchHtml(obj){
    var keyword=$.trim($("#pro_keyword").val());
    if(isempty(keyword)){keyword=$.trim($(".dv_keyword_list .keyword_text").val());}
    if(keyword!=""){
        if(obj==0){
            _aClickOpenWindow('/search/Search.html?keyword='+keyword,"_self");
        }
    }
}
//添加收藏
function _addFavorites(obj){
    var proid=$(obj).attr("proid");
    var params={"proid":proid,"cas":$(obj).attr("cas"),"am":$(obj).attr("ak"),"remak":""};
    _DoAjaxAsyncTrue("POST",params,'/webapi/v1/mem/favorites',function(){
        $(obj).attr("src","/static/img/xin-red.png").attr("proid",proid).attr("onclick","_delFavorites(this)");
        $(obj).parent().addClass("isFavorites");
    });
}
//取消收藏
function _delFavorites(obj){
    var proid=$(obj).attr("proid");
    _DoAjaxAsyncTrue("DELETE",{},'/webapi/v1/mem/favorites/'+proid,function(){
        $(obj).attr("src","/static/img/xin-add.png").attr("onclick","_addFavorites(this)");
        $(obj).parent().removeClass("isFavorites");
    });
}
//获取产品主图
function _getProimg(proimg){
    var simgsrc=filedomain+"/static/upload/proimg";//图片地址
    if(!isempty(proimg)){
        if(proimg.indexOf("file.")>-1){//后台已处理
            return proimg
        }
        if(proimg.indexOf(",")>-1){//原数据，未处理img.png,img2.png,img3.png
            return simgsrc+proimg.split(",")[0];
        }else{
            return simgsrc+proimg
        }
    }else{
        return simgsrc+"/default.png";//默认图片;
    }
}

//动态加载JS，并且等待JS加载完成后执行回调
function _loadScript(url, callback){
     var script = document.createElement ("script");
     script.type = "text/javascript";
     if (script.readyState){ //IE
        script.onreadystatechange = function(){
            if (script.readyState == "loaded" || script.readyState == "complete"){
            script.onreadystatechange = null;
            callback();
            }
         };
     } else { //Others
         script.onload = function(){
            callback();
         };
     }
     script.src = url;
     document.getElementsByTagName("head")[0].appendChild(script);
}