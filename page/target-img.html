<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <script type="text/javascript" src="/static/js/jquery.js?t=202211301545"></script>
    <script type="text/javascript" src="/static/js/Tdrag.js?v=20240327001"></script>
    <style type="text/css">
        *{margin:0;padding:0;}
        .fixed_btn{margin:5px;position:fixed;z-index:10000;}
        .fixed_btn button{cursor:pointer;width:24px;height:24px;}
        #box{position:absolute;cursor:all-scroll;}
        #box a{position:absolute;display:inline-block;font-size:0;}
        #box a.on:hover{box-shadow:0 0 10px #fa9430;}
        @media only screen and (max-width:480px){
            #box img{height:auto!important;width:auto!important;max-width:100%;}
        }
    </style>
</head>
<body style="overflow:hidden;">
    <p class="fixed_btn"><button onclick="zoomIn()"> + </button> <button onclick="zoomOut()"> - </button></p>
    <div id="box">
        <img id="targetImg" class="drag" src="/static/img/target/PI3K-Akt-mTOR.jpg" alt="">
        <div id="diva">
        </div>
    </div>

    <script>
        //box拖拽
        $(function(){
            $("#box").Tdrag();
        });
        //图片宽高/2
        var imgObj = document.getElementById('targetImg');
        var imgWidth = (imgObj.naturalWidth)/2;
        var imgHeight = (imgObj.naturalHeight)/2;
        $("#targetImg").css({
            "width":imgWidth+"px",
            "height":imgHeight+"px"
        })
        //靶点url/位点数据
        var targetData = [
            {"height":2.26,"radius":20,"width":9.54,"left":40.06,"top":21.16,"name":"PIK3CA","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":40.06,"top":24.03,"name":"PIK3CB","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":40.06,"top":26.77,"name":"PIK3CG","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":51.35,"top":21.16,"name":"PIK3R1","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":51.35,"top":24.03,"name":"PIK3R2","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":51.35,"top":26.77,"name":"PIK3R3","url":"/pi3k.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":10.65,"top":35.91,"name":"PTEN","url":"/pten.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":57.55,"top":38.18,"name":"PDK1","url":"/pdk-1.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":18.04,"top":50.91,"name":"FOXO1","url":"/foxo.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":18.04,"top":53.57,"name":"FOXO3","url":"/foxo.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":18.04,"top":56.18,"name":"FOXO4","url":"/foxo.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":45.71,"top":44.93,"name":"AKT","url":"/akt.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":71.14,"top":59.45,"name":"MTOR","url":"/mtor.html"}
            ,{"height":2.26,"radius":20,"width":9.54,"left":45.87,"top":77.54,"name":"MTOR","url":"/mtor.html"}
        ]
        //加载靶点url/位点数据
        _loadahtml(targetData)
        function _loadahtml(data){
            var ahtml = '';
            $.each(data, function(idx, item) {
                ahtml += '<a class="on" target="_blank" href="'+item.url+'" style="height:'+item.height+'%;width:'+item.width+'%;border-radius:'+item.radius+'px;left:'+item.left+'%;top:'+item.top+'%;">'+item.name+'</a>'
            })
            $("#diva").html(ahtml)
        }
        //滚轮控制大小
        var resizableElement = document.getElementById('box');
        resizableElement.addEventListener('wheel', function (event){
            event.preventDefault();
            if (event.deltaY < 0) { // 滚轮向上
                zoomIn()
            } else { // 滚轮向下
                zoomOut()
            }
        });
        function zoomIn(){
            var scaleFactor = 1.1; // 定义缩放因子
            var currentScale = resizableElement.scale || 1;

            resizableElement.scale = currentScale * scaleFactor;
            if(resizableElement.scale > 1.9){
                resizableElement.scale = 2;
            }
            resizableElement.style.transform = 'scale('+resizableElement.scale+')';
        }
        function zoomOut(){
            var scaleFactor = 1.1; // 定义缩放因子
            var currentScale = resizableElement.scale || 1;

            resizableElement.scale = currentScale / scaleFactor;
            if(resizableElement.scale < 0.5){
                resizableElement.scale = 0.5;
            }
            resizableElement.style.transform = 'scale('+resizableElement.scale+')';
        }


        var firstDistance = 0;
        function getDistance (start, stop){
            return Math.sqrt(Math.pow(Math.abs(start.x - stop.x), 2) + Math.pow(Math.abs(start.y - stop.y), 2));
        }

        resizableElement.addEventListener('touchstart', function (event) {
            const touches = event.touches;

            if( touches.length > 1){
                const events1 = touches[0];
                const events2 = touches[1];

                const one = {
                    x:events1.pageX,
                    y:events1.pageY,
                }
                const two = {
                    x:events2.pageX,
                    y:events2.pageY,
                }
                firstDistance = getDistance(one, two)
            }
            event.preventDefault();
        });

        resizableElement.addEventListener('touchmove', function (event) {
            event.preventDefault();
            const touches = event.touches;

            if( touches.length > 1){
                const events1 = touches[0];
                const events2 = touches[1];

                const one = {
                    x:events1.pageX,
                    y:events1.pageY,
                }
                const two = {
                    x:events2.pageX,
                    y:events2.pageY,
                }
                const distance = getDistance(one, two);
                const zoom = distance / firstDistance;
                content.style.transform = 'scale(' + zoom + ')';
            }  
        });

        //移动端拖拽
        function Touch(ele){
            var _this=this;
            this.ele=ele;
            this.transP={
                x:0,
                y:0
            };
            this.events={
                handleEvent:function(event){
                    switch(event.type){
                        case 'touchstart':
                            _this.start(event);
                            break;
                        case 'touchmove':
                            _this.move(event);
                            break;
                        case 'touchend':
                            _this.end(event);
                            break;
                    }
                }
            }
        }
        Touch.prototype = {

            start:function(ev){
                var touches=ev.targetTouches[0],
                _this=this;
                this.disP={
                    x:touches.pageX-this.transP.x,
                    y:touches.pageY-this.transP.y,
                    id:touches.identifier
                };
                //console.log('start');
                _this.ele.addEventListener('touchmove',_this.events,false);
                _this.ele.addEventListener('touchend',_this.events,false);
            },
            move:function(ev){
                var touches=ev.targetTouches[0];
                if(touches.identifier== this.disP.id){
                    //console.log('move');
                    this.transP={
                        x:touches.pageX-this.disP.x,
                        y:touches.pageY-this.disP.y
                    };
                    this.ele.style.transform='translate3d('+this.transP.x+'px,'+this.transP.y+'px,0)';
                    this.ele.style.Webkittransform='translate3d('+this.transP.x+'px,'+this.transP.y+'px,0)';
                }
            },
            end:function(ev){
                ev=ev||window.event;
                var _this=this;
                if(ev.changedTouches[0].identify==this.disP.id){
                    _this.ele.removeEventListener('touchmove',_this.events,false);
                    _this.ele.removeEventListener('touchend',_this.events,false);
                }
            },
            init:function(){
                var _this=this;
                this.ele.addEventListener('touchstart',_this.events,false);
            }
        };
        window.onload=function(){
            var box=document.getElementById('box'),
                touch=new Touch(box);
            touch.init();
        };
    </script>
</body>
</html>