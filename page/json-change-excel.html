<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta name="robots" content="index,follow">
<meta name="format-detection" content="telephone=no,email=no">
<meta name="google-site-verification" content="2v2b-8ma3sxVzH8TAl7ebxgM91sxNbXU0Kd5GAVeuCc">
<title>DEMO - JSON 数据转 Excel 表格</title>

<meta property="og:site_name" content="joyous-quan.github.io">
<meta property="og:url" content="https://joyous-quan.github.io/page/json-change-excel.html">
<meta property="og:type" content="website">
<meta property="og:title" content="JSON 数据转 Excel 表格 | og">
<meta property="og:description" content="JSON 数据转 Excel 表格，jquery，xlsx.full.js，jquery.share.min.js | og">
<meta property="og:updated_time" content="2022-10-21">
<meta property="og:image" content="https://joyous-quan.github.io/img/logo.png">
<meta property="og:image:secure_url" content="https://joyous-quan.github.io/img/logo.png">
<meta property="og:image:type" content="image/png">
<meta property="og:image:width" content="63">
<meta property="og:image:height" content="63">
<meta property="og:image" content="https://joyous-quan.github.io/img/json-excel.jpg">
<meta property="og:image:secure_url" content="https://joyous-quan.github.io/img/json-excel.jpg">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:width" content="1000">
<meta property="og:image:height" content="470">
<!-- twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@joyous-quan.github.io">
<meta name="twitter:title" content="JSON 数据转 Excel 表格 | twitter">
<meta name="twitter:description" content="JSON 数据转 Excel 表格，jquery，xlsx.full.js，jquery.share.min.js | twitter">
<meta name="twitter:image" content="https://joyous-quan.github.io/img/json-excel.jpg">
<link rel="canonical" href="https://joyous-quan.github.io/page/json-change-excel.html">

<link rel="shortcut icon" href="/static/img/favicon.ico?t=202210211430" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="/static/css/common.css?t=202210211430">
<link rel="stylesheet" type="text/css" href="/static/share/css/share.min.css?t=202210211430">
<script type="text/javascript" src="/static/js/jquery.js?t=202210211430"></script>
<script type="text/javascript" src="/static/js/xlsx.full.min.js?t=202210211430"></script>
<script type="text/javascript" src="/static/share/js/jquery.share.min.js?t=202210211430"></script>
<style type="text/css">
	.dv_box{display:inline-block;width:100%;}
	.dv_kuang{margin-top:10px;min-height:500px;padding:10px;border:1px solid #aaa;}
	.dv_left{float:left;width:38%;}
	.dv_left textarea{width:100%;min-height:470px;border:none;resize:none;}
	.dv_right{float:right;width:60%;}
	.dv_right p{line-height:36px;}
	#share{display:inline-block;}
	#share .qrcode{margin:10px auto 0;}
	.mtb-10{margin:10px 0;}
</style>
</head>
<body class="demo_body">
	<div class="demo_header">
        <div class="layout">
            <a href="/index.html"> 首页 </a>
        </div>
    </div>
    <div class="demo_main">
    	<div class="layout">
	        <h2 class="title_h2">JSON 数据转 Excel 表格</h2>
            <p class="text_content">使用<a class="link_a" href="https://sheetjs.com/" rel="noopener norefferrer" target="_blank"> xlsx.full.js </a></p>
			<div class="dv_box">
				<div class="dv_left">
					<p><button class="btn btn_blue" onclick="json_tab()">导出 Excel 文件</button> 请在文本框内输入 JSON 数据</p>
					<div class="dv_kuang">
						<textarea id="textarea" placeholder="输入 JSON 数据">[{"product_id":"001","product_name":"苹果","product_price":"10"},{"product_id":"002","product_name":"香蕉","product_price":"8"},{"product_id":"003","product_name":"草莓","product_price":"20"},{"product_id":"004","product_name":"芒果","product_price":"16"}]</textarea>
					</div>
				</div>
				<div class="dv_right">
					<p>TABLE 展示 JSON 数据 <a class="btn btn_green float_r" href="/page/excel-change-json.html" target="_blank">Excel 转 JSON 数据</a></p>
					<div class="dv_kuang">
						<table id="table">
							<thead>
								<tr class="tab_thead">
								</tr>
							</thead>
							<tbody class="tab_tbody">
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="mtb-10">
                分享到：  
                <div id="share"></div>
            </div>
		</div>
    </div>
    <div class="dv_footer">
        <p class="layout">&copy;2021 joyous-quan.github.io <a href="mailto:joyous-quan@outlook.com">Contact US</a></p>
    </div>

<script>
	$(document).ready(function(){
        // 分享到
        $('#share').share({ sites: ['facebook', 'twitter', 'linkedin', 'tencent', 'google', 'weibo', 'wechat', 'qzone', 'qq', 'douban', 'diandian'] });
    })
	// 将一个sheet转成最终的excel文件的blob对象，然后利用URL.createObjectURL下载
	function sheetToBlob(sheet, sheetName) {
	    sheetName = sheetName || 'sheet1';
	    var workbook = {
	        SheetNames: [sheetName],
	        Sheets: {}
	    };
	    workbook.Sheets[sheetName] = sheet; // 生成excel的配置项

	    var wopts = {
	        bookType: 'xlsx', // 要生成的文件类型
	        bookSST: false, // 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性
	        type: 'binary'
	    };
	    var wbout = XLSX.write(workbook, wopts);
	    var blob = new Blob([strToArrBuf(wbout)], {
	        type: "application/octet-stream"
	    }); // 字符串转ArrayBuffer
	    function strToArrBuf(s) {
	        var buf = new ArrayBuffer(s.length);
	        var view = new Uint8Array(buf);
	        for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
	        return buf;
	    }
	    return blob;
	}

	function openDownloadDialog(url, saveName) {
	    if (typeof url == 'object' && url instanceof Blob) {
	        url = URL.createObjectURL(url); // 创建blob地址
	    }
	    var aLink = document.createElement('a');
	    aLink.href = url;
	    aLink.download = saveName || ''; // HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效
	    var event;
	    if (window.MouseEvent) event = new MouseEvent('click');
	    else {
	        event = document.createEvent('MouseEvents');
	        event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
	    }
	    aLink.dispatchEvent(event);
	}

	//导出Excel文件
	function excel_export() {
	    var table = document.querySelector("#table");
	    var sheet = XLSX.utils.table_to_sheet(table);//将一个table对象转换成一个sheet对象
	    openDownloadDialog(sheetToBlob(sheet),'excel.xlsx');//
	}

	//JSON 转 table
	function json_tab(){
		var txtValObj = JSON.parse($('#textarea').val());
		var tbodyHtml='',theadHtml='';

		for (var key in txtValObj[0]) {
			theadHtml += '<td>'+key+'</td>';
		}
		//遍历
		$.each(txtValObj, function (idx, item) {
			tbodyHtml += '<tr>'
			$.each(item, function (subidx, subitem) {
				tbodyHtml +='<td>'+subitem+'</td>';
			})
			tbodyHtml +='</tr>'
		});

		$('.tab_thead').html(theadHtml);//thead html
		$('.tab_tbody').html(tbodyHtml);//tbody html

		excel_export()
	};
</script>
</body>
</html>